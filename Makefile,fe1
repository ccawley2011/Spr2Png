# spr2png

# Toolflags:
link = link

CCflags = -c -fah -depend !Depend -IC:,C:ImageLib.libpng,C:zlib -throwback -DRISCOS -DPNG_DEBUG=0 $(DEBUG) -apcs 3/32
CCopt   = -Otime -Ospace -zpq32
Linkflags = -aif -c++ -nounused $(LDEBUG) -o $@
ObjAsmflags = -throwback -depend !Depend -APCS 3/32 -pd "ARM32 SETA 1"

s2p_OBJS =      o.spr2png o.s2p_const o.s2p_frqsrt o.s2p_reduce \
                o.s2p_trim o.s2p_ver
s2p_LIBS =      o.heap o.library C:o.stubs \
                C:ImageLib.o.libpng-lib C:zlib.o.zlib
p2s_OBJS =      o.png2spr o.p2s_ver
p2s_LIBS =      $(s2p_LIBS)
d2s_OBJS =      o.draw2spr o.d2s_conv o.d2s_render o.d2s_trim \
                o.d2s_ver
d2s_LIBS =      o.heap o.library C:o.stubs

# Final targets:
All:    !Spr2Png.spr2png !Spr2Png.draw2spr !Spr2Png.png2spr !Spr2Png.!RunImage # !Version

!Version: !Spr2Png.spr2png !Spr2Png.draw2spr !Spr2Png.png2spr
        pipe "!Spr2Png.spr2png --version" "sed -e \"1! d\" -e \"1 s/^spr2png \([^)]*)\).*$/set spr2png$version \\1/\"" > !Version'
        pipe "!Spr2Png.draw2spr --version" "sed -e \"1! d\" -e \"1 s/^draw2spr \([^)]*)\).*$/set draw2spr$version \\1/\"" >> !Version'
        pipe "!Spr2Png.png2spr --version" "sed -e \"1! d\" -e \"1 s/^png2spr \([^)]*)\).*$/set png2spr$version \\1/\"" >> !Version'
        remove !Version
        rename !Version' !Version
        settype !Version Obey

!Spr2Png.spr2png: $(s2p_OBJS) $(s2p_LIBS)
        $(link) $(Linkflags) $(s2p_OBJS) $(s2p_LIBS)
        squeeze $@

!Spr2Png.draw2spr: $(d2s_OBJS) $(d2s_LIBS)
        $(link) $(Linkflags) $(d2s_OBJS) $(d2s_LIBS)
        squeeze $@

!Spr2Png.png2spr: $(p2s_OBJS) $(p2s_LIBS)
        $(link) $(Linkflags) $(p2s_OBJS) $(p2s_LIBS)
        squeeze $@

!Spr2Png.!RunImage: bas.!RunImage
        tokenize bas.!RunImage -out $@

clean:
        remove !Spr2Png.!RunImage
        remove !Spr2Png.spr2png
        remove !Spr2Png.draw2spr
        remove !Spr2Png.png2spr
        ifthere o.* then wipe o.* ~CF~R~V

# Rules:
.SUFFIXES: .c .s .o

.INIT:; @CDir o

.c.o:;  cc $(CCflags) $(CCopt) $<
.s.o:;  objasm $(ObjAsmflags) $<

# Static dependencies:
o.spr2png:      c.spr2png
o.s2p_const:    c.s2p_const
o.s2p_frqsrt:   c.s2p_frqsrt
o.s2p_reduce:   c.s2p_reduce c.s2p_redinc
o.s2p_trim:     c.s2p_trim c.s2p_triinc
o.s2p_ver:      c.s2p_ver

o.draw2spr:     c.draw2spr
o.d2s_conv:     c.d2s_conv
o.d2s_render:   s.d2s_render
o.d2s_trim:     c.d2s_trim
o.d2s_ver:      c.d2s_ver

o.png2spr:      c.png2spr
o.p2s_ver:      c.p2s_ver

o.heap:         s.heap
o.library:      c.library

# Dynamic dependencies:
o.draw2spr:	c.draw2spr
o.draw2spr:	C:h.swis
o.draw2spr:	C:h.kernel
o.draw2spr:	C:h.kernel
o.draw2spr:	h.d2s_lib
o.draw2spr:	h.library
o.draw2spr:	h.types
o.draw2spr:	C:h.kernel
o.d2s_conv:	c.d2s_conv
o.d2s_conv:	C:h.swis
o.d2s_conv:	C:h.kernel
o.d2s_conv:	C:h.kernel
o.d2s_conv:	h.d2s_lib
o.d2s_conv:	h.library
o.d2s_conv:	h.types
o.d2s_conv:	C:h.kernel
o.d2s_render: s.d2s_render
o.d2s_render: s.ARM32
o.d2s_trim:	c.d2s_trim
o.d2s_trim:	C:h.swis
o.d2s_trim:	C:h.kernel
o.d2s_trim:	h.library
o.d2s_trim:	h.types
o.d2s_trim:	C:h.kernel
o.d2s_trim:	h.d2s_lib
o.d2s_trim:	h.library
o.png2spr:	c.png2spr
o.png2spr:	C:h.swis
o.png2spr:	C:h.kernel
o.png2spr:	C:h.kernel
o.png2spr:	C:zlib.h.zlib
o.png2spr:	C:zlib.h.zconf
o.png2spr:	C:ImageLib.libpng.h.png
o.png2spr:	C:ImageLib.libpng.h.pnglibconf
o.png2spr:	C:ImageLib.libpng.h.pngconf
o.png2spr:	h.library
o.png2spr:	h.types
o.png2spr:	C:h.kernel
o.library:	c.library
o.library:	C:h.swis
o.library:	C:h.kernel
o.library:	C:h.kernel
o.library:	h.types
o.library:	h.library
o.library:	h.types
o.library:	C:h.kernel
o.s2p_const:	c.s2p_const
o.s2p_const:	C:ImageLib.libpng.h.png
o.s2p_const:	C:ImageLib.libpng.h.pnglibconf
o.s2p_const:	C:ImageLib.libpng.h.pngconf
o.s2p_const:	h.s2p_lib
o.s2p_const:	h.library
o.s2p_const:	h.types
o.s2p_const:	C:h.kernel
o.s2p_const:	C:ImageLib.libpng.h.png
o.s2p_const:	h.s2p_const
o.s2p_frqsrt:	c.s2p_frqsrt
o.s2p_frqsrt:	C:ImageLib.libpng.h.png
o.s2p_frqsrt:	C:ImageLib.libpng.h.pnglibconf
o.s2p_frqsrt:	C:ImageLib.libpng.h.pngconf
o.s2p_frqsrt:	h.s2p_lib
o.s2p_frqsrt:	h.library
o.s2p_frqsrt:	h.types
o.s2p_frqsrt:	C:h.kernel
o.s2p_frqsrt:	C:ImageLib.libpng.h.png
o.s2p_reduce:	c.s2p_reduce
o.s2p_reduce:	C:h.swis
o.s2p_reduce:	C:h.kernel
o.s2p_reduce:	C:ImageLib.libpng.h.png
o.s2p_reduce:	C:ImageLib.libpng.h.pnglibconf
o.s2p_reduce:	C:ImageLib.libpng.h.pngconf
o.s2p_reduce:	h.s2p_lib
o.s2p_reduce:	h.library
o.s2p_reduce:	h.types
o.s2p_reduce:	C:h.kernel
o.s2p_reduce:	C:ImageLib.libpng.h.png
o.s2p_reduce:	c.s2p_redinc
o.s2p_reduce:	c.s2p_redinc
o.s2p_trim:	c.s2p_trim
o.s2p_trim:	C:h.swis
o.s2p_trim:	C:h.kernel
o.s2p_trim:	h.s2p_lib
o.s2p_trim:	h.library
o.s2p_trim:	h.types
o.s2p_trim:	C:h.kernel
o.s2p_trim:	C:ImageLib.libpng.h.png
o.s2p_trim:	C:ImageLib.libpng.h.pnglibconf
o.s2p_trim:	C:ImageLib.libpng.h.pngconf
o.s2p_trim:	c.s2p_triinc
o.s2p_trim:	c.s2p_triinc
o.s2p_trim:	c.s2p_triinc
o.s2p_trim:	c.s2p_triinc
o.spr2png:	c.spr2png
o.spr2png:	C:h.swis
o.spr2png:	C:h.kernel
o.spr2png:	C:h.kernel
o.spr2png:	C:zlib.h.zlib
o.spr2png:	C:zlib.h.zconf
o.spr2png:	C:ImageLib.libpng.h.png
o.spr2png:	C:ImageLib.libpng.h.pnglibconf
o.spr2png:	C:ImageLib.libpng.h.pngconf
o.spr2png:	h.s2p_lib
o.spr2png:	h.library
o.spr2png:	h.types
o.spr2png:	C:h.kernel
o.spr2png:	C:ImageLib.libpng.h.png
o.spr2png:	h.s2p_const
